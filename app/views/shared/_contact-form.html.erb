<%= simple_form_for Message.new do |f| %>
  <h2><%= Title.find_by_unique_key("contact_form_title")&.translate(locale) %></h2>
  <%= f.input :name, label:t('form.name') %>
  <%= f.input :company,  label:t('form.company') %>
  <%= f.input :email,  label:t('form.email') %>
  <%= f.input :phone,  label:t('form.phone') %>
  <%= f.input :attachment, as: :file, label:t('form.attachment') %>
  <%= f.input :content, label:t('form.message'), as: :text %>
  <div class="field d-none">
    <input class="checkbot" id="checkbot" name="message[checkbot]" value="" />
    <label for="human"><%= t('form.human') %></label>
  </div>
  <div class="field d-none">
    <input class="checkmark" type="checkbox" id="human" name="message[robot]"/>
    <label for="human"><%= t('form.human') %></label>
  </div>
  <div class="field">
    <div class="g-recaptcha" data-sitekey="6Leq-ZYgAAAAAGFXLTnAWjkwonj4qbyyTlJ2ytVv" data-callback="onRecaptchaSuccess"
    data-expired-callback="onRecaptchaResponseExpiry"
    data-error-callback="onRecaptchaError"></div>
  </div>
  <%= f.submit t('form.send'), class:"primary contact-form-submit", id:"btnsubmit" , disabled: true%>
<% end %>

<script>
  let isRecaptchaValidated = false;

  function toggleRecaptchaFormMessage(type = "error", hide = false) {
    document.getElementById(`contact-form-${type}`).style.display = hide
      ? "none"
      : "inherit";
  }

  function onRecaptchaSuccess() {
    isRecaptchaValidated = true;
    document.getElementById("btnsubmit").disabled = false;
    document.getElementById("checkbot").value = "okay";
  }

  function onRecaptchaError() {
    // toggleRecaptchaFormMessage("error");
    // toggleRecaptchaFormMessage("success", true);
  }

  function onRecaptchaResponseExpiry() {
    // onRecaptchaError();
  }

  const recaptchaForm = document.getElementById("contact-form");
  recaptchaForm.addEventListener("submit", function (e) {
    console.log("toto");
    e.preventDefault();

    // failure
    if (!isRecaptchaValidated) {
      console.log('bot');
      // toggleRecaptchaFormMessage("error");
      // toggleRecaptchaFormMessage("success", true);
      return;
    }

    // success
    document.getElementById("contact-form").submit();
  });
</script>
